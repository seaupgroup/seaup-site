<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Atomy HemoHIM - Register</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, "Noto Sans TC", "Noto Sans SC", "Microsoft JhengHei", sans-serif; background: #f8fafc; margin: 0; padding: 0; }
    .main { max-width: 440px; margin: 44px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 16px #eee; padding: 28px; }
    .main h2 { color: #ea4a2b; margin-bottom: 16px; }
    .main label { font-weight: bold; display: block; margin-top: 17px; }
    select, button { width: 100%; font-size: 1em; margin-top: 7px; padding: 8px; border-radius: 8px; border: 1px solid #d4d4d4; }
    button { background: #ea4a2b; color: #fff; border: none; font-weight: bold; margin-top: 22px; cursor: pointer; transition: background 0.15s;}
    button:hover { background: #d5371b; }
    .msg { margin-top: 24px; color: #d5371b; font-weight: bold; min-height: 32px;}
    .lang-sel { text-align:right; margin-bottom: 6px;}
    .lang-sel select {width:auto;}
  </style>
</head>
<body>
  <div class="main">
    <div class="lang-sel">
      <label style="font-size:1em;font-weight:bold;">üåê</label>
      <select id="uiLangSel" onchange="setUILang(this.value)">
        <option value="en">English</option>
        <option value="zh_tw">ÁπÅÈ´î‰∏≠Êñá</option>
        <option value="zh_cn">ÁÆÄ‰Ωì‰∏≠Êñá</option>
        <option value="fr">Fran√ßais</option>
        <option value="de">Deutsch</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="th">‡πÑ‡∏ó‡∏¢</option>
        <option value="es">Espa√±ol</option>
        <option value="pt">Portugu√™s</option>
        <option value="fil">Filipino</option>
        <option value="id">Bahasa Indonesia</option>
      </select>
    </div>
    <h2 id="ui_title">Atomy HemoHIM Member Registration</h2>
    <label for="regionInput" id="ui_region_label">Region</label>
    <select id="regionInput"></select>
    <label for="langInput" id="ui_lang_label">Language</label>
    <select id="langInput"></select>
    <button id="submitBtn" onclick="getCodeAndRedirect()">Get Member Number</button>
    <div id="msg" class="msg"></div>
    <div style="margin-top:30px;text-align:center;">
      <a id="redeemLink" href="https://form.jotform.com/251414756620050" target="_blank" style="color:#ea4a2b; text-decoration:underline; font-size:1em;">‰ΩèÂÆøÂà∏ÂÖåÊèõË°®ÂñÆ / Redeem Voucher</a>
    </div>
  </div>
  <script>
    // Â§öË™ûÊñáÊú¨Ë®≠ÂÆö
    const uiLangs = ["en","zh_tw","zh_cn","fr","de","ru","th","es","pt","fil","id"];
    const texts = {
      ui_title: {
        en: "Atomy HemoHIM Member Registration",
        zh_tw: "Atomy HemoHIM ÊúÉÂì°Á∑®ËôüÈ†òÂèñ",
        zh_cn: "Atomy HemoHIM ‰ºöÂëòÁºñÂè∑È¢ÜÂèñ",
        fr: "Inscription Membre Atomy HemoHIM",
        de: "Atomy HemoHIM Mitgliederanmeldung",
        ru: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ Atomy HemoHIM",
        th: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å Atomy HemoHIM",
        es: "Registro de Miembro Atomy HemoHIM",
        pt: "Registro de Membro Atomy HemoHIM",
        fil: "Atomy HemoHIM Member Registration",
        id: "Pendaftaran Anggota Atomy HemoHIM"
      },
      ui_region_label: {
        en:"Region", zh_tw:"Âú∞ÂçÄ", zh_cn:"Âú∞Âå∫", fr:"R√©gion", de:"Region", ru:"–†–µ–≥–∏–æ–Ω", th:"‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ", es:"Regi√≥n", pt:"Regi√£o", fil:"Rehiyon", id:"Wilayah"
      },
      ui_lang_label: {
        en:"Language", zh_tw:"Ë™ûË®Ä", zh_cn:"ËØ≠Ë®Ä", fr:"Langue", de:"Sprache", ru:"–Ø–∑—ã–∫", th:"‡∏†‡∏≤‡∏©‡∏≤", es:"Idioma", pt:"Idioma", fil:"Wika", id:"Bahasa"
      },
      submitBtn: {
        en:"Get Member Number", zh_tw:"È†òÂèñÊúÉÂì°Á∑®Ëôü", zh_cn:"È¢ÜÂèñ‰ºöÂëòÁºñÂè∑", fr:"Obtenir un num√©ro de membre", de:"Mitgliedsnummer erhalten", ru:"–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞", th:"‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å", es:"Obtener n√∫mero de miembro", pt:"Obter n√∫mero de membro", fil:"Kunin ang Member Number", id:"Dapatkan Nomor Anggota"
      },
      msg_choose: {
        en:"Please select region and language.",
        zh_tw:"Ë´ãÈÅ∏ÊìáÂú∞ÂçÄËàáË™ûË®Ä„ÄÇ",
        zh_cn:"ËØ∑ÈÄâÊã©Âú∞Âå∫‰∏éËØ≠Ë®Ä„ÄÇ",
        fr:"Veuillez choisir une r√©gion et une langue.",
        de:"Bitte w√§hlen Sie Region und Sprache.",
        ru:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –∏ —è–∑—ã–∫.",
        th:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏≤",
        es:"Por favor seleccione regi√≥n e idioma.",
        pt:"Por favor, selecione regi√£o e idioma.",
        fil:"Paki pili ng rehiyon at wika.",
        id:"Silakan pilih wilayah dan bahasa."
      },
      msg_wait: {
        en:"Please wait, assigning member number...",
        zh_tw:"Ë´ãÁ®çÂÄôÔºåÊ≠£Âú®ÂàÜÈÖçÊúÉÂì°Á∑®Ëôü...",
        zh_cn:"ËØ∑Á®çÂÄôÔºåÊ≠£Âú®ÂàÜÈÖç‰ºöÂëòÁºñÂè∑...",
        fr:"Veuillez patienter, attribution du num√©ro...",
        de:"Bitte warten, Mitgliedsnummer wird zugewiesen...",
        ru:"–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞...",
        th:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...",
        es:"Espere mientras se asigna el n√∫mero...",
        pt:"Por favor, aguarde enquanto atribu√≠mos o n√∫mero...",
        fil:"Sandali lang, ina-assign ang member number...",
        id:"Mohon tunggu, sedang menugaskan nomor anggota..."
      },
      msg_error: {
        en:"Error: ",
        zh_tw:"ÈåØË™§Ôºö",
        zh_cn:"ÈîôËØØÔºö",
        fr:"Erreur¬†: ",
        de:"Fehler: ",
        ru:"–û—à–∏–±–∫–∞: ",
        th:"‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ",
        es:"Error: ",
        pt:"Erro: ",
        fil:"Error: ",
        id:"Kesalahan: "
      },
      msg_fail: {
        en:"API connection failed. Please try again.",
        zh_tw:"APIÈÄ£Á∑öÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ",
        zh_cn:"APIËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ",
        fr:"Connexion API √©chou√©e. Veuillez r√©essayer.",
        de:"API-Verbindung fehlgeschlagen. Bitte versuchen Sie es erneut.",
        ru:"–°–±–æ–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
        th:"‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
        es:"Conexi√≥n API fallida. Int√©ntelo de nuevo.",
        pt:"Falha na conex√£o API. Por favor, tente novamente.",
        fil:"API connection failed. Pakisubukan muli.",
        id:"Koneksi API gagal. Silakan coba lagi."
      }
    };

    // Âú∞ÂçÄÈÅ∏ÂñÆ
    const regions = [
      {en:"Taiwan", zh_tw:"Âè∞ÁÅ£", zh_cn:"Âè∞Êπæ", fr:"Ta√Øwan", de:"Taiwan", ru:"–¢–∞–π–≤–∞–Ω—å", th:"‡πÑ‡∏ï‡πâ‡∏´‡∏ß‡∏±‡∏ô", es:"Taiw√°n", pt:"Taiwan", fil:"Taiwan", id:"Taiwan"},
      {en:"Hong Kong", zh_tw:"È¶ôÊ∏Ø", zh_cn:"È¶ôÊ∏Ø", fr:"Hong Kong", de:"Hongkong", ru:"–ì–æ–Ω–∫–æ–Ω–≥", th:"‡∏Æ‡πà‡∏≠‡∏á‡∏Å‡∏á", es:"Hong Kong", pt:"Hong Kong", fil:"Hong Kong", id:"Hong Kong"},
      {en:"Singapore", zh_tw:"Êñ∞Âä†Âù°", zh_cn:"Êñ∞Âä†Âù°", fr:"Singapour", de:"Singapur", ru:"–°–∏–Ω–≥–∞–ø—É—Ä", th:"‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå", es:"Singapur", pt:"Singapura", fil:"Singapore", id:"Singapura"},
      {en:"Malaysia", zh_tw:"È¶¨‰æÜË•ø‰∫û", zh_cn:"È©¨Êù•Ë•ø‰∫ö", fr:"Malaisie", de:"Malaysia", ru:"–ú–∞–ª–∞–π–∑–∏—è", th:"‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢", es:"Malasia", pt:"Mal√°sia", fil:"Malaysia", id:"Malaysia"},
      {en:"Thailand", zh_tw:"Ê≥∞Âúã", zh_cn:"Ê≥∞ÂõΩ", fr:"Tha√Ølande", de:"Thailand", ru:"–¢–∞–∏–ª–∞–Ω–¥", th:"‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢", es:"Tailandia", pt:"Tail√¢ndia", fil:"Thailand", id:"Thailand"},
      {en:"France", zh_tw:"Ê≥ïÂúã", zh_cn:"Ê≥ïÂõΩ", fr:"France", de:"Frankreich", ru:"–§—Ä–∞–Ω—Ü–∏—è", th:"‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™", es:"Francia", pt:"Fran√ßa", fil:"France", id:"Perancis"},
      {en:"Germany", zh_tw:"Âæ∑Âúã", zh_cn:"Âæ∑ÂõΩ", fr:"Allemagne", de:"Deutschland", ru:"–ì–µ—Ä–º–∞–Ω–∏—è", th:"‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏ô‡∏µ", es:"Alemania", pt:"Alemanha", fil:"Germany", id:"Jerman"},
      {en:"Russia", zh_tw:"‰øÑÁæÖÊñØ", zh_cn:"‰øÑÁΩóÊñØ", fr:"Russie", de:"Russland", ru:"–†–æ—Å—Å–∏—è", th:"‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢", es:"Rusia", pt:"R√∫ssia", fil:"Russia", id:"Rusia"},
      {en:"Philippines", zh_tw:"Ëè≤ÂæãË≥ì", zh_cn:"Ëè≤ÂæãÂÆæ", fr:"Philippines", de:"Philippinen", ru:"–§–∏–ª–∏–ø–ø–∏–Ω—ã", th:"‡∏ü‡∏¥‡∏•‡∏¥‡∏õ‡∏õ‡∏¥‡∏ô‡∏™‡πå", es:"Filipinas", pt:"Filipinas", fil:"Pilipinas", id:"Filipina"},
      {en:"Indonesia", zh_tw:"Âç∞Â∞º", zh_cn:"Âç∞Â∞º", fr:"Indon√©sie", de:"Indonesien", ru:"–ò–Ω–¥–æ–Ω–µ–∑–∏—è", th:"‡∏≠‡∏¥‡∏ô‡πÇ‡∏î‡∏ô‡∏µ‡πÄ‡∏ã‡∏µ‡∏¢", es:"Indonesia", pt:"Indon√©sia", fil:"Indonesia", id:"Indonesia"},
      {en:"Spain", zh_tw:"Ë•øÁè≠Áâô", zh_cn:"Ë•øÁè≠Áâô", fr:"Espagne", de:"Spanien", ru:"–ò—Å–ø–∞–Ω–∏—è", th:"‡∏™‡πÄ‡∏õ‡∏ô", es:"Espa√±a", pt:"Espanha", fil:"Spain", id:"Spanyol"}
    ];

    // Ë™ûË®ÄÈÅ∏ÂñÆ
    const langOptions = [
      {val:"en", label: {en:"English", zh_tw:"Ëã±Êñá", zh_cn:"Ëã±ËØ≠", fr:"Anglais", de:"Englisch", ru:"–ê–Ω–≥–ª–∏–π—Å–∫–∏–π", th:"‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", es:"Ingl√©s", pt:"Ingl√™s", fil:"Ingles", id:"Inggris"}},
      {val:"zh_tw", label: {en:"Traditional Chinese", zh_tw:"ÁπÅÈ´î‰∏≠Êñá", zh_cn:"ÁπÅ‰Ωì‰∏≠Êñá", fr:"Chinois traditionnel", de:"Traditionelles Chinesisch", ru:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–∏—Ç–∞–π—Å–∫–∏–π", th:"‡∏à‡∏µ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°", es:"Chino tradicional", pt:"Chin√™s tradicional", fil:"Tradisyonal na Chinese", id:"Chinese Tradisional"}},
      {val:"zh_cn", label: {en:"Simplified Chinese", zh_tw:"Á∞°È´î‰∏≠Êñá", zh_cn:"ÁÆÄ‰Ωì‰∏≠Êñá", fr:"Chinois simplifi√©", de:"Vereinfachtes Chinesisch", ru:"–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∫–∏—Ç–∞–π—Å–∫–∏–π", th:"‡∏à‡∏µ‡∏ô‡∏ï‡∏±‡∏ß‡∏¢‡πà‡∏≠", es:"Chino simplificado", pt:"Chin√™s simplificado", fil:"Simplified Chinese", id:"Chinese Sederhana"}},
      {val:"fr", label: {en:"French", zh_tw:"Ê≥ïÊñá", zh_cn:"Ê≥ïËØ≠", fr:"Fran√ßais", de:"Franz√∂sisch", ru:"–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π", th:"‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™", es:"Franc√©s", pt:"Franc√™s", fil:"Pranses", id:"Perancis"}},
      {val:"de", label: {en:"German", zh_tw:"Âæ∑Êñá", zh_cn:"Âæ∑ËØ≠", fr:"Allemand", de:"Deutsch", ru:"–ù–µ–º–µ—Ü–∫–∏–π", th:"‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô", es:"Alem√°n", pt:"Alem√£o", fil:"Aleman", id:"Jerman"}},
      {val:"ru", label: {en:"Russian", zh_tw:"‰øÑÊñá", zh_cn:"‰øÑËØ≠", fr:"Russe", de:"Russisch", ru:"–†—É—Å—Å–∫–∏–π", th:"‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢", es:"Ruso", pt:"Russo", fil:"Ruso", id:"Rusia"}},
      {val:"th", label: {en:"Thai", zh_tw:"Ê≥∞Êñá", zh_cn:"Ê≥∞ËØ≠", fr:"Tha√Ø", de:"Thail√§ndisch", ru:"–¢–∞–π—Å–∫–∏–π", th:"‡πÑ‡∏ó‡∏¢", es:"Tailand√©s", pt:"Tailand√™s", fil:"Thai", id:"Thailand"}},
      {val:"es", label: {en:"Spanish", zh_tw:"Ë•øÁè≠ÁâôÊñá", zh_cn:"Ë•øÁè≠ÁâôËØ≠", fr:"Espagnol", de:"Spanisch", ru:"–ò—Å–ø–∞–Ω—Å–∫–∏–π", th:"‡∏™‡πÄ‡∏õ‡∏ô", es:"Espa√±ol", pt:"Espanhol", fil:"Espanyol", id:"Spanyol"}},
      {val:"pt", label: {en:"Portuguese", zh_tw:"Ëë°ËêÑÁâôÊñá", zh_cn:"Ëë°ËêÑÁâôËØ≠", fr:"Portugais", de:"Portugiesisch", ru:"–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π", th:"‡πÇ‡∏õ‡∏£‡∏ï‡∏∏‡πÄ‡∏Å‡∏™", es:"Portugu√©s", pt:"Portugu√™s", fil:"Portuges", id:"Portugis"}},
      {val:"fil", label: {en:"Filipino", zh_tw:"Ëè≤ÂæãË≥ìÊñá", zh_cn:"Ëè≤ÂæãÂÆæËØ≠", fr:"Philippin", de:"Filipino", ru:"–§–∏–ª–∏–ø–ø–∏–Ω—Å–∫–∏–π", th:"‡∏ü‡∏¥‡∏•‡∏¥‡∏õ‡∏õ‡∏¥‡∏ô‡∏™‡πå", es:"Filipino", pt:"Filipino", fil:"Filipino", id:"Filipino"}},
      {val:"id", label: {en:"Bahasa Indonesia", zh_tw:"Âç∞Â∞ºÊñá", zh_cn:"Âç∞Â∞ºËØ≠", fr:"Indon√©sien", de:"Indonesisch", ru:"–ò–Ω–¥–æ–Ω–µ–∑–∏–π—Å–∫–∏–π", th:"‡∏≠‡∏¥‡∏ô‡πÇ‡∏î‡∏ô‡∏µ‡πÄ‡∏ã‡∏µ‡∏¢", es:"Indonesio", pt:"Indon√©sio", fil:"Indonesian", id:"Bahasa Indonesia"}}
    ];

    function setUILang(lang) {
      // Ê®ôÈ°åËàáÊ®ôÁ±§
      document.getElementById('ui_title').textContent = texts.ui_title[lang];
      document.getElementById('ui_region_label').textContent = texts.ui_region_label[lang];
      document.getElementById('ui_lang_label').textContent = texts.ui_lang_label[lang];
      document.getElementById('submitBtn').textContent = texts.submitBtn[lang];

      // Âú∞ÂçÄÈÅ∏ÂñÆ
      const rSel = document.getElementById('regionInput');
      rSel.innerHTML = '';
      regions.forEach(opt => {
        let o = document.createElement('option');
        o.value = opt[lang] || opt.en;
        o.text = opt[lang] || opt.en;
        rSel.appendChild(o);
      });

      // Ë™ûË®ÄÈÅ∏ÂñÆ
      const lSel = document.getElementById('langInput');
      lSel.innerHTML = '';
      langOptions.forEach(opt => {
        let o = document.createElement('option');
        o.value = opt.val;
        o.text = opt.label[lang];
        lSel.appendChild(o);
      });
    }

    // ÂàùÂßãÂåñ
    let defaultLang = (navigator.language || '').toLowerCase();
    if (defaultLang.startsWith('zh') && defaultLang.includes('tw')) defaultLang = 'zh_tw';
    else if (defaultLang.startsWith('zh')) defaultLang = 'zh_cn';
    else if (!uiLangs.includes(defaultLang)) defaultLang = 'en';
    setUILang(defaultLang);
    document.getElementById('uiLangSel').value = defaultLang;

    async function getCodeAndRedirect() {
      const region = document.getElementById('regionInput').value;
      const lang = document.getElementById('langInput').value;
      const uiLang = document.getElementById('uiLangSel').value;
      const msgDiv = document.getElementById('msg');
      msgDiv.textContent = "";

      if (!region || !lang) {
        msgDiv.textContent = texts.msg_choose[uiLang];
        return;
      }
      msgDiv.textContent = texts.msg_wait[uiLang];
      try {
        const resp = await fetch('https://script.google.com/macros/s/AKfycbwatarqL8yQzmQpX9UBqxpiFs5RuqfvFgI7tOfqJKequkRs6SJ0tm2ayLRc9ur-oOYQ/exec', {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ action: "register", region: region, lang: lang })
        });
        const data = await resp.json();
        if (data.error) {
          msgDiv.textContent = texts.msg_error[uiLang] + data.error;
          return;
        }
        // ÁµÑÊàê JotForm È†êÂ°´Á∂≤ÂùÄ
        const jotformUrl = `https://form.jotform.com/251412432618046?member_number=${encodeURIComponent(data.member_number)}&password=${encodeURIComponent(data.password)}&website=${encodeURIComponent(data.official_website)}&lang
